<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Danh Sách Gói Vay Tốt Nhất | VayNhanh24h</title>
    <meta name="robots" content="noindex, nofollow">
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* GIỐNG INDEX */
        :root {
            --primary: #fec629; --primary-dark: #e5b225;
            --text: #111827; --text-gray: #6b7280;
            --bg: #f8fafc; --white: #ffffff;
            --radius: 16px; --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Manrope', sans-serif; background:var(--bg); color:var(--text); line-height:1.6; }
        .container { max-width:1140px; margin:0 auto; padding:0 20px; }

        /* HEADER */
        .header { background:rgba(255,255,255,0.95); backdrop-filter:blur(10px); height:70px; position:sticky; top:0; z-index:100; border-bottom:1px solid #f1f5f9; display:flex; align-items:center; }
        .header-inner { display:flex; justify-content:space-between; align-items:center; width:100%; }
        .logo { display:flex; align-items:center; gap:8px; text-decoration:none; }
        .logo span { font-weight:800; font-size:20px; color:var(--text); letter-spacing:-0.5px; }
        .logo span b { color:#d97706; }
        .btn-back { background:#f1f5f9; color:var(--text); padding:8px 20px; border-radius:50px; font-weight:700; font-size:14px; transition:0.3s; }

        /* CONTENT */
        .page-head { text-align:center; padding:40px 0 30px; }
        .page-head h1 { font-size:32px; font-weight:800; margin-bottom:10px; }
        .page-head p { color:var(--text-gray); }

        .offers-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:25px; padding-bottom:60px; }
        
        /* CARD */
        .card { background:var(--white); border-radius:var(--radius); border:1px solid #e5e7eb; overflow:hidden; position:relative; display:flex; flex-direction:column; box-shadow:var(--shadow); height:100%; transition:0.3s; }
        .card:hover { transform:translateY(-5px); border-color:var(--primary); box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); }
        .badge { position:absolute; top:15px; right:15px; background:#dcfce7; color:#16a34a; padding:4px 10px; border-radius:6px; font-size:11px; font-weight:700; text-transform:uppercase; z-index:2; }
        
        .card-head { padding:20px; height:80px; display:flex; align-items:center; justify-content:center; border-bottom:1px solid #f8fafc; }
        .card-logo { max-height:40px; max-width:140px; object-fit:contain; }
        
        .card-body { padding:20px; flex:1; }
        .brand-name { text-align:center; font-weight:800; font-size:18px; margin-bottom:15px; }
        .info-row { display:flex; justify-content:space-between; font-size:14px; margin-bottom:10px; border-bottom:1px dashed #f1f5f9; padding-bottom:8px; }
        .info-row:last-child { border:none; }
        .info-val { font-weight:700; }
        .hl { color:#d97706; }

        .card-foot { padding:0 20px 25px; }
        .btn-loan { display:flex; justify-content:center; align-items:center; width:100%; padding:14px; background:var(--primary); color:#000; font-weight:800; border-radius:12px; text-decoration:none; transition:0.2s; }
        .btn-loan:hover { background:var(--primary-dark); transform:translateY(-2px); }
        .disabled { opacity:0.5; pointer-events:none; filter:grayscale(100%); }

        /* FOOTER */
        .footer { background:var(--white); border-top:1px solid #e5e7eb; padding:40px 0 20px; text-align:center; margin-top:auto; color:var(--text-gray); font-size:14px; }

        #helper-box { background:#111827; color:#10b981; padding:20px; border-radius:12px; margin:20px auto; display:none; }
        #helper-textarea { width:100%; height:100px; background:#000; color:#fff; border:1px solid #374151; padding:10px; margin-top:10px; }
        .test-alert { background:#fee2e2; color:#b91c1c; padding:10px; text-align:center; font-weight:bold; font-size:13px; }
        .reset-btn { margin-top:10px; font-size:11px; color:#ef4444; cursor:pointer; background:none; border:none; text-decoration:underline; }

        @media (max-width: 768px) { .offers-grid { grid-template-columns:1fr; gap:20px; } }
    </style>
</head>
<body>

    <div id="test-alert" class="test-alert" style="display:none;">⚠️ CHẾ ĐỘ TEST: ĐANG BẬT</div>

    <header class="header">
        <div class="container header-inner">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 40 40" fill="none"><rect width="40" height="40" rx="12" fill="#FEC629"/><path d="M22 8L12 22H20L18 32L28 18H20L22 8Z" fill="white" stroke="#111827" stroke-width="2"/></svg>
                <span>VAYNHANH<b>24H</b></span>
            </a>
            <a href="index.html" class="btn-back"><i class="fa-solid fa-arrow-left"></i> Trang chủ</a>
        </div>
    </header>

    <div class="container">
        <div class="page-head">
            <h1>Đề Xuất Tốt Nhất</h1>
            <p>Dựa trên hồ sơ của bạn, đây là các gói vay có tỷ lệ duyệt cao nhất.</p>
        </div>

        <div id="helper-box">
            <h3>⚠️ COPY VÀO LINKS.JSON</h3>
            <textarea id="helper-textarea"></textarea>
        </div>

        <div id="offers-grid" class="offers-grid">
            <div style="text-align:center; padding:50px; grid-column:1/-1;">
                <i class="fa-solid fa-circle-notch fa-spin" style="font-size:30px; color:#fec629;"></i>
                <p style="margin-top:10px; color:#666;">Đang tìm kiếm ưu đãi...</p>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>Bản quyền © 2024 VayNhanh24h.vn</p>
            <div id="user-ip" style="font-size:11px; margin-top:10px; color:#9ca3af">Checking IP...</div>
            <button class="reset-btn" onclick="resetHistory()">[Xóa lịch sử Test]</button>
            <br><a href="admin-tool.html" style="font-size:11px; color:#e5e7eb;">Admin</a>
        </div>
    </footer>

    <script>
        const PUB_ID = "28janns";
        const TOKEN = "hpoRHLinw3JgcQaV6g6SaQ=="; 
        const CHE_DO_TEST = true; 
        const API_URL = `https://publisher-api.riofintech.net/offer/all?pub_id=${PUB_ID}&token=${encodeURIComponent(TOKEN)}`;

        async function checkUserIP() {
            const el = document.getElementById('user-ip');
            try { const res = await fetch('https://api.ipify.org?format=json'); const data = await res.json(); el.innerText = `IP: ${data.ip}`; } catch (e) { el.innerText = ''; }
        }

        function trackClick(brandKey) {
            if (CHE_DO_TEST) return true;
            let clicked = JSON.parse(localStorage.getItem('vn24h_click') || '[]');
            if (!clicked.includes(brandKey)) { clicked.push(brandKey); localStorage.setItem('vn24h_click', JSON.stringify(clicked)); }
            return true; 
        }

        function resetHistory() {
            if(confirm('Xóa lịch sử?')) { localStorage.removeItem('vn24h_click'); location.reload(); }
        }

        function getSmartInfo(name) {
            let n = name.toLowerCase();
            if(n.includes('doctor')) return { limit: '10 Triệu', rate: '0% Lần đầu', time: '30 ngày' };
            if(n.includes('moneycat')) return { limit: '15 Triệu', rate: '0% Phí', time: '7 - 30 ngày' };
            if(n.includes('takomo')) return { limit: '10 Triệu', rate: 'Duyệt nhanh', time: 'Linh hoạt' };
            if(n.includes('vayvnd')) return { limit: '15 Triệu', rate: '0% Lãi', time: '30 ngày' };
            if(n.includes('f88') || n.includes('vietmoney')) return { limit: '50 Triệu', rate: 'Cầm đồ', time: '12 tháng' };
            return { limit: '10 Triệu', rate: 'Ưu đãi tốt', time: 'Linh hoạt' };
        }

        function getCleanName(raw) {
            return raw.replace(/\(.*\)/g, '').replace(/(VN|CP|CPL|CPS|CPI|Android|iOS|Web|App|APK)/gi, '').trim();
        }

        function getBrandKey(name) { return name.toLowerCase().trim().split(/[\s\-\.\(\)]+/)[0]; }

        function getMyLink(name, links) {
            if (!links) return null;
            for (const [key, url] of Object.entries(links)) {
                if (url && url.length > 5 && name.toLowerCase().includes(key.toLowerCase())) return url;
            }
            return null;
        }

        async function init() {
            checkUserIP();
            if (CHE_DO_TEST) document.getElementById('test-alert').style.display = 'block';
            
            const grid = document.getElementById('offers-grid');
            const helper = document.getElementById('helper-box');

            try {
                const [apiRes, linkRes] = await Promise.all([ fetch(API_URL), fetch('links.json').catch(() => null) ]);
                const apiData = await apiRes.json();
                let myLinks = {};
                if (linkRes && linkRes.ok) { myLinks = await linkRes.json(); } else { helper.style.display = 'block'; }

                if (apiData.status !== 1 || !apiData.data) throw new Error("No Data");

                if (helper.style.display === 'block') {
                    let txt = "{\n" + apiData.data.map((o,i) => `  "${o.name}": ""` + (i<apiData.data.length-1?",":"")).join("\n") + "\n}";
                    document.getElementById('helper-textarea').value = txt;
                }

                let clicked = JSON.parse(localStorage.getItem('vn24h_click') || '[]');
                let uniqueMap = {};

                apiData.data.forEach(item => {
                    let brand = getBrandKey(item.name);
                    if (!CHE_DO_TEST && clicked.includes(brand)) return;

                    let link = getMyLink(item.name, myLinks);
                    let hasLink = !!link;

                    if (!uniqueMap[brand] || (!uniqueMap[brand].hasLink && hasLink)) {
                        uniqueMap[brand] = { ...item, display: getCleanName(item.name), link: link, hasLink: hasLink, info: getSmartInfo(item.name), brandKey: brand };
                    }
                });

                let offers = Object.values(uniqueMap).sort((a,b) => b.hasLink - a.hasLink);

                if (offers.length === 0) {
                    grid.innerHTML = '<div style="text-align:center; padding:40px; background:#fff; border-radius:12px; grid-column:1/-1;"><h3>Bạn đã đăng ký hết!</h3><p>Vui lòng quay lại sau 24h.</p></div>';
                    return;
                }

                grid.innerHTML = offers.map(o => {
                    let active = o.hasLink;
                    let clsBox = active ? "card" : "card disabled";
                    let badge = active ? `<div class="badge">Đề xuất</div>` : ``;
                    let btnCls = active ? "btn-loan" : "btn-loan disabled";
                    let btnTxt = active ? 'ĐĂNG KÝ NGAY' : 'TẠM DỪNG';
                    let href = active ? o.link : "javascript:void(0)";
                    let target = active ? "_blank" : "_self";
                    let onclick = active ? `onclick="trackClick('${o.brandKey}')"` : "";

                    return `
                    <div class="${clsBox}">
                        ${badge}
                        <div class="card-head"><img src="${o.avatar}" class="card-logo" onerror="this.style.display='none'"></div>
                        <div class="card-body">
                            <h3 class="brand-name">${o.display}</h3>
                            <div class="info-row"><span>Hạn mức</span><span class="info-val hl" style="font-size:16px">${o.info.limit}</span></div>
                            <div class="info-row"><span>Lãi suất</span><span class="info-val">${o.info.rate}</span></div>
                            <div class="info-row"><span>Thời hạn</span><span class="info-val">${o.info.time}</span></div>
                        </div>
                        <div class="card-foot">
                            <a href="${href}" target="${target}" class="${btnCls}" ${onclick}>${btnTxt}</a>
                        </div>
                    </div>`;
                }).join('');

            } catch (e) { grid.innerHTML = `<p style="text-align:center;width:100%;color:red">Lỗi kết nối.</p>`; }
        }

        init();
    </script>
</body>
</html>
